%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#E2E8F0', 'primaryTextColor': '#0F172A', 'primaryBorderColor': '#CBD5E1', 'lineColor': '#64748B', 'secondaryColor': '#F8FAFC', 'tertiaryColor': '#F1F5F9', 'background': '#FFFFFF', 'mainBkg': '#FFFFFF', 'textColor': '#0F172A'}}}%%

flowchart LR
  subgraph Client["Client"]
    Browser["Browser UI"]
  end

  subgraph Edge["Cloudflare Workers"]
    Worker["Hono Worker<br/>HTML + API + WebSocket"]
  end

  subgraph DO["Durable Objects"]
    UserDO["UserDO<br/>profiles + settings + context"]
    PostDO["PostDO<br/>likes + reposts"]
    FeedDO["FeedDO<br/>timeline"]
    WebSocketDO["WebSocketDO<br/>realtime"]
  end

  subgraph Storage["Storage"]
    KV["KV Namespaces<br/>USERS / POSTS / SESSIONS / FEEDS"]
    R2["R2 Media Bucket"]
  end

  subgraph Async["Async"]
    Queue["Fanout Queue"]
    Cron["Scheduled Jobs<br/>rankings + cleanup"]
  end

  Browser -->|HTTP/WS| Worker
  Worker --> UserDO
  Worker --> PostDO
  Worker --> FeedDO
  Worker --> WebSocketDO
  Worker --> KV
  Worker --> R2
  Worker --> Queue
  Queue --> FeedDO
  Queue --> WebSocketDO
  Cron --> KV
